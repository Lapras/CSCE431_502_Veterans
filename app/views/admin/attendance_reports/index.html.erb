<!-- app/views/admin/attendance_reports/index.html.erb -->
<% content_for :title, "Attendance History" %>

<h1>Attendance History</h1>

<%= form_with url: admin_attendance_reports_path, method: :get, local: true, class: "search-form" do %>
  <div>
    <label for="q">Search name or email</label>
    <input type="text" id="q" name="q" value="<%= h @q %>" />
    <button type="submit">Search</button>
    <% if @q.present? %>
      <%= link_to "Clear", admin_attendance_reports_path %>
    <% end %>
  </div>
<% end %>

<div class="sort-status">
  <span class="sort-status__label">Sorted by:</span>
  <span class="sort-status__pill <%= current_sort_dir %>">
    <%= current_sort_title %> <span class="sort-status__arrow"><%= current_sort_arrow %></span>
  </span>
</div>

<table class="table">
  <thead>
    <tr>
      <th><%= sort_link("Name",   :name) %></th>
      <th><%= sort_link("Email",  :email) %></th>
      <th style="text-align:right;"><%= sort_link("Total",:total) %></th>
      <th style="text-align:right;"><%= sort_link("Present",:present) %></th>
      <th style="text-align:right;"><%= sort_link("Absent", :absent) %></th>
      <th style="text-align:right;"><%= sort_link("Tardy",  :tardy) %></th>
      <th style="text-align:right;"><%= sort_link("Excused",:excused) %></th>
    </tr>
  </thead>
  <tbody>
    <% @rows.each do |u| %>
      <tr>
        <td><%= u.full_name.presence || "â€”" %></td>
        <td><%= u.email %></td>
        <td style="text-align:right;"><%= u.read_attribute(:weighed_total) %></td>
        <td style="text-align:right;"><%= u.read_attribute(:total_presents) %></td>
        <td style="text-align:right;"><%= u.read_attribute(:total_absences) %></td>
        <td style="text-align:right;"><%= u.read_attribute(:total_tardies) %></td>
        <td style="text-align:right;"><%= u.read_attribute(:total_excused) %></td>
      </tr>
    <% end %>
  </tbody>
</table>