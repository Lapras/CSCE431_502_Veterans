<!-- app/views/dashboards/show.html.erb -->
<h1>Welcome, <%= current_user.full_name %>!</h1>

<% if current_user.has_role?(:member) || current_user.has_role?(:admin) %>
  <% stats = current_user.attendance_stats %>
  <h2>My Attendance Summary</h2>

  <div class="attendance-summary">
    <div class="stat-card">
      <span class="stat-value"><%= stats[:total_events] %></span>
      <span class="stat-label">Total Events</span>
    </div>

    <div class="stat-card present">
      <span class="stat-value"><%= stats[:present] %></span>
      <span class="stat-label">Present</span>
    </div>

    <div class="stat-card absent">
      <span class="stat-value"><%= stats[:absent] %></span>
      <span class="stat-label">Absent</span>
    </div>

    <div class="stat-card excused">
      <span class="stat-value"><%= stats[:excused] %></span>
      <span class="stat-label">Excused</span>
    </div>

    <div class="stat-card tardy">
      <span class="stat-value"><%= stats[:tardy] %></span>
      <span class="stat-label">Tardy</span>
    </div>

    <div class="stat-card discipline">
      <span class="stat-value"><%= stats[:discipline] %></span>
      <span class="stat-label">Discipline</span>
    </div>

    <div class="stat-card points">
      <span class="stat-value"><%= stats[:points] %></span>
      <span class="stat-label">Total Points</span>
    </div>
  </div>

  <% upcoming_events = Event.where('starts_at >= ?', Time.current).order(:starts_at).limit(5) %>
  <% if upcoming_events.any? %>
    <h2>Upcoming Events</h2>
    <table>
      <thead>
        <tr>
          <th>Event</th>
          <th>Date & Time</th>
          <th>Location</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <% upcoming_events.each do |event| %>
          <% attendance = event.attendance_for(current_user) %>
          <tr>
            <td><%= link_to event.title, event %></td>
            <td><%= event.starts_at.strftime("%b %d, %Y at %I:%M %p") %></td>
            <td><%= event.location %></td>
            <td>
              <% if attendance %>
                <%= attendance.status_label %>
              <% else %>
                Not Registered
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
<% end %>